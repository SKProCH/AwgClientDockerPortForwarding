version: "3.8"
services:
  amnezia:
    build: .
    container_name: amnezia-client
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    sysctls:
      - net.ipv4.conf.all.src_valid_mark=1
    volumes:
      # Place your AmneziaWG configuration file in the same directory as docker-compose.yaml
      # and mount it inside the container as /config/awg0.conf
      - ./awg.conf:/config/awg0.conf:ro
    restart: unless-stopped

  my-app:
    image: greenstatic/echo-ip
    container_name: echo-ip
    # All traffic routes through the amnezia container's network stack
    network_mode: service:amnezia
    depends_on:
      - amnezia